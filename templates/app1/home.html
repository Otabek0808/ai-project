{% extends 'base.html' %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boshqaruv Paneli</title>
  <style>
    .static_contaner_section {
        width: auto;
        max-width: 100%;
        height: auto;
        display: flex;
        gap: 10px;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    .contaner_info {
        width: 100%;
        height: auto;
        backdrop-filter: blur(10px);
        background-color: rgba(255, 255, 255, 0.511);
        border-radius: 10px;
        padding: 25px;
        border: 0.1px solid white;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .contaner_info:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .log_num {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .log_num svg {
        width: 50px;
        height: 50px;
        backdrop-filter: blur(10px);
        background-color: rgba(255, 255, 255, 0.511);
        padding: 10px;
        border-radius: 10px;
    }
    .log_num h2 {
        font-size: 36px;
        margin: 0;
    }
    .contaner_info p {
        font-size: 18px;
        margin-top: 20px;
        margin-bottom: 0;
        font-weight: 500;
    }

    /* Grafik kontayneri */
    .graphic-container {
        margin-top: 20px;
        width: 100%;
        height: auto;
        backdrop-filter: blur(10px);
        background-color: rgba(255, 255, 255, 0.511);
        border-radius: 10px;
        padding: 25px;
        border: 0.1px solid white;
        margin-bottom: 20px;
    }

    /* Ikki ustunli ma'lumotlar */
    .two-columns {
        display: flex;
        gap: 20px;
        margin-top: 20px;
    }
    .column {
        flex: 1;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .column h5 {
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 15px;
        color: #007bff;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Materiallar ro'yxati */
    .material-list {
        max-height: 300px;
        overflow-y: auto;
    }
    .material-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    .material-item:last-child {
        border-bottom: none;
    }
    .material-count {
        background: #007bff;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
    }
    .material-details {
        display: flex;
        gap: 10px;
        font-size: 12px;
        color: #666;
    }

    /* Progress ro'yxati */
    .progress-list {
        max-height: 300px;
        overflow-y: auto;
    }
    .progress-item {
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    .progress-item:last-child {
        border-bottom: none;
    }
    .progress-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
    }
    .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 1s ease-in-out;
    }
    .progress-fill.high { background: #4CAF50; }
    .progress-fill.medium { background: #FFC107; }
    .progress-fill.low { background: #F44336; }

    /* Umumiy statistika */
    .overall-stats {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    .stat-card {
        flex: 1;
        min-width: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
    }
    .stat-value {
        font-size: 32px;
        font-weight: bold;
        margin: 10px 0;
    }
    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }

    @media (max-width:1225px) {
        .contaner_info {
            padding: 20px;
        }
        .log_num{
            gap: 12px;
        }
        .log_num svg{
            width: 40px;
            height: 40px;
        }
        .log_num h2{
            font-size: 24px;
        }
        .contaner_info p{
            font-size: 14px;
            margin-top: 10px;
        }
        .two-columns {
            flex-direction: column;
        }
        .overall-stats {
            flex-direction: column;
        }
        .stat-card {
            min-width: 100%;
        }
    }
    @media (max-width:1030px) {
        .static_contaner_section{
            flex-wrap: wrap;
        }
        .contaner_info{
            flex: 0 0 49%;
            padding: 15px;
        }
    }
    @media (max-width:840px) {
        .contaner_info{
            flex: 35%;
        }
    }
  </style>
</head>
<body>

    <main>
        <!-- Asosiy statistik kartalar -->
        <section class="static_contaner_section">
            <!-- Foydalanuvchilar -->
            <div class="contaner_info">
                <div class="log_num">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-percent" viewBox="0 0 16 16" style="color: orange">
                        <path d="M13.442 2.558a.625.625 0 0 1 0 .884l-10 10a.625.625 0 1 1-.884-.884l10-10a.625.625 0 0 1 .884 0M4.5 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m7 6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m0 1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 1 0 0 5"/>
                    </svg>
                    <h2>{{ user_count }}</h2>
                </div>
                <p>Foydalanuvchilar soni</p>
            </div>
            {% if graphic %}

            <!-- Videodarslar -->
            <div class="contaner_info">
                <div class="log_num">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file" viewBox="0 0 16 16" style="color: rgb(52, 52, 148)">
                        <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
                    </svg>
                    <h2>{{ videos_count }}</h2>
                </div>
                <p>Aktiv foydalanuvchilar</p>
            </div>
            {% endif %}

            <!-- Testlar -->
            <div class="contaner_info">
                <div class="log_num">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16" style="color: green">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                    </svg>
                    <h2>{{ test_count }}</h2>
                </div>
                <p>Yuqori natija ko'rsatgan talabalar</p>
            </div>

<!--             Tavsiya -->
            <div class="contaner_info">
                <div class="log_num">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-90deg-right" viewBox="0 0 16 16" style="color: blueviolet">
                        <path fill-rule="evenodd" d="M14.854 4.854a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 4H3.5A2.5 2.5 0 0 0 1 6.5v8a.5.5 0 0 0 1 0v-8A1.5 1.5 0 0 1 3.5 5h9.793l-3.147 3.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                    {% if user.is_authenticated %}
                        {% if data.avg_percentage < 50 %}
                            <h2>O'z ustingizda ishlang</h2>
                        {% else %}
                            <h3>Natijagiz yaxshi</h3>
    <!--                    <h2>{{ documents_count }}</h2>-->
                        {% endif %}
                    {% else %}
                        <p>Natijangiz yo'q!Fanlarni o'zlashtiring va natijangizni bilib oling!</p>
                    {% endif %}
                </div>
<!--                <p>Materiallar</p>-->
            </div>


        </section>

        <!-- Umumiy statistika -->
        <div class="overall-stats">
            <div class="stat-card">
                <div>üìö</div>
                <div class="stat-value">{{ total_subjects }}</div>
                <div class="stat-label">Jami fanlar</div>
            </div>
            {% if request.user.is_authenticated and user_subject_progress %}
            <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);">
                <div>üìà</div>
                <div class="stat-value">{{ avg_progress|floatformat:1 }}%</div>
                <div class="stat-label">O'rtacha o'zlashtirish</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%);">
                <div>‚úÖ</div>
                <div class="stat-value">{{ user_subject_progress|length }}</div>
                <div class="stat-label">O'zlashtirilgan fanlar</div>
            </div>
            {% endif %}
        </div>

        <!-- Grafik -->
        <div class="graphic-container">
            <h4 style="display: flex; align-items: center; gap: 10px;">
                üìä Fanlar statistikasi
            </h4>
            {% if graphic %}
            <div class="text-center">
                <img src="data:image/png;base64,{{ graphic }}" alt="Fanlar statistikasi grafigi" class="img-fluid border rounded" style="max-height: 500px;">
                <div class="mt-3" style="display: flex; justify-content: center; gap: 20px; font-size: 12px; color: #666;">
                    <div>
                        <span style="display: inline-block; width: 15px; height: 15px; background: #4CAF50; border-radius: 50%; margin-right: 5px;"></span>
                        Yaxshi (80-100%)
                    </div>
                    <div>
                        <span style="display: inline-block; width: 15px; height: 15px; background: #FFC107; border-radius: 50%; margin-right: 5px;"></span>
                        O'rtacha (60-79%)
                    </div>
                    <div>
                        <span style="display: inline-block; width: 15px; height: 15px; background: #F44336; border-radius: 50%; margin-right: 5px;"></span>
                        Qoniqarsiz (0-59%)
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-center text-muted py-5">
                <p>Statistika grafigi mavjud emas</p>
            </div>
            {% endif %}
        </div>

        <!-- Ikki ustunli ma'lumotlar -->
        <div class="two-columns">
            <!-- Fanlar bo'yicha materiallar -->
            <div class="column">
                <h5>üìö Fanlar bo'yicha materiallar</h5>
                <div class="material-list">
                    {% for subject, data in subject_materials.items %}
                    <div class="material-item">
                        <div>
                            <strong>{{ subject }}</strong>
                            <div class="material-details">
                                <span>üìπ {{ data.videos }} video</span>
                                <span>üìÑ {{ data.documents }} material</span>
                                <span>üìù {{ data.tests }} test</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span class="material-count">{{ data.total }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Foydalanuvchi o'zlashtirishi -->
            {% if request.user.is_authenticated and user_subject_progress %}
            <div class="column">
                <h5>üë§ {{ request.user.username }} - O'zlashtirish darajasi</h5>
                <div class="progress-list">
                    {% for subject, data in user_subject_progress.items %}
                    <div class="progress-item">
                        <div class="progress-header">
                            <strong>{{ subject }}</strong>
                            <span class="{% if data.avg_percentage >= 80 %}text-success{% elif data.avg_percentage >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                {{ data.avg_percentage|floatformat:1 }}%
                            </span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-fill
                                {% if data.avg_percentage >= 80 %}high
                                {% elif data.avg_percentage >= 60 %}medium
                                {% else %}low{% endif %}"
                                style="width: {{ data.avg_percentage }}%">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="column">
                <h5>üë§ O'zlashtirish darajasi</h5>
                <div class="text-center text-muted py-4">
                    <p>Tizimga kiring va test topshiring</p>
                    <a href="{% url 'login' %}" class="btn btn-primary mt-2">Tizimga kirish</a>
                </div>
            </div>
            {% endif %}
        </div>
    </main>
</body>
</html>
{% endblock %}