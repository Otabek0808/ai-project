{% extends 'base.html' %} {% block content %}
<div class="container mt-4" style="margin-bottom: 5rem">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
          <h3 class="card-title mb-0">
            <i class="fas fa-chart-bar"></i> Test Natijasi
          </h3>
        </div>
        <div class="card-body text-center">
          <!-- Test ma'lumotlari -->
          <h4 class="text-primary">{{ test.title }}</h4>
          {#
          <p class="text-muted">{{ test.description|default:"" }}</p>
          #}

          <!-- Asosiy natija -->
          <div class="row mt-4">
            <div class="col-md-6 mb-3">
              <div class="card border-success">
                <div class="card-body">
                  <h6 class="card-title text-success">
                    <i class="fas fa-check-circle"></i> To'g'ri Javoblar
                  </h6>
                  <h2 class="text-success">
                    {{ score }}/{{ total_questions }}
                  </h2>
                  <small class="text-muted">Savollar soni</small>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card border-info">
                <div class="card-body">
                  <h6 class="card-title text-info">
                    <i class="fas fa-percentage"></i> Foiz
                  </h6>
                  <h2 class="text-info">{{ percentage|floatformat:1 }}%</h2>
                  <small class="text-muted">Umumiy natija</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Vaqt ma'lumotlari -->
          {% if time_taken_seconds %}
          <div class="card border-warning mt-3">
            <div class="card-body">
              <h6 class="card-title text-warning">
                <i class="fas fa-clock"></i> Sarflangan Vaqt
              </h6>
              <h4 class="text-warning">
                {% widthratio time_taken_seconds 60 1 as minutes %} {{ minutes
                }} daqiqa {{ time_taken_seconds|divisibleby:60|yesno:",0" }}
                soniya
              </h4>
              <small class="text-muted"
                >Testni ishlash uchun sarflangan vaqt</small
              >
            </div>
          </div>
          {% endif %}

          <!-- Baholash -->
          <div
            class="mt-4 p-3 rounded {% if percentage >= 90 %}bg-success text-white {% elif percentage >= 70 %}bg-info text-white {% elif percentage >= 50 %}bg-warning {% else %}bg-danger text-white{% endif %}"
          >
            <h5>
              {% if percentage >= 90 %}
              <i class="fas fa-star"></i> A'lo! Juda yaxshi! {% elif percentage
              >= 70 %} <i class="fas fa-thumbs-up"></i> Yaxshi! {% elif
              percentage >= 50 %} <i class="fas fa-check"></i> Qoniqarli {% else
              %} <i class="fas fa-redo"></i> Qaytadan o'rganib chiqing {% endif
              %}
            </h5>
            <p class="mb-0">
              {% if percentage >= 90 %} Siz bu mavzuni mukammal
              o'zlashtirgansiz! {% elif percentage >= 70 %} Yaxshi natija, lekin
              yana mashq qilish foydali bo'ladi. {% elif percentage >= 50 %}
              O'rtacha natija, mavzuni qaytadan ko'rib chiqing. {% else %}
              Mavzuni qaytadan o'rganib chiqishingiz kerak. {% endif %}
            </p>
          </div>

          <!-- Harakatlar -->
          <div class="mt-4 d-grid gap-2 d-md-flex justify-content-center">
            <a href="{% url 'tests' %}" class="btn btn-primary me-2">
              <i class="fas fa-list"></i> Boshqa Testlar
            </a>
            <!-- test_results URL ni olib tashladim -->
            <a href="{% url 'take_test' test.id %}" class="btn btn-success">
              <i class="fas fa-redo"></i> Qayta Urinish
            </a>
          </div>

          <!-- Progress bar -->
          <div class="mt-4">
            <div class="d-flex justify-content-between mb-1">
              <small>0%</small>
              <small>50%</small>
              <small>100%</small>
            </div>
            <div class="progress" style="height: 20px">
              <div
                class="progress-bar {% if percentage >= 90 %}bg-success {% elif percentage >= 70 %}bg-info {% elif percentage >= 50 %}bg-warning {% else %}bg-danger{% endif %}"
                role="progressbar"
                style="width: {{ percentage }}%;"
                aria-valuenow="{{ percentage }}"
                aria-valuemin="0"
                aria-valuemax="100"
              >
                {{ percentage|floatformat:1 }}%
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer text-muted text-center">
          <small
            >Test {{ test.uploaded_at|date:"d.m.Y H:i" }} da yuklangan</small
          >
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    border: none;
    border-radius: 15px;
  }
  .progress {
    border-radius: 10px;
  }
  .progress-bar {
    border-radius: 10px;
    font-weight: bold;
  }
</style>
{% endblock %}
